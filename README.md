# 樹莓派跌倒偵測專案

本專案利用樹莓派進行攝影機影像捕捉，並透過經 Tailscale VPN 建立的連線，將影像資料傳輸至虛擬機，進而透過 Flask 網頁伺服器進行即時影像串流顯示。主要目的是提供一個穩定、即時的影像監控與跌倒偵測平台。

## 架構說明

專案主要包含兩個程式：
- **sender.py** (樹莓派端)：從攝影機擷取影像，進行 JPEG 壓縮，並透過 TCP Socket 傳送給伺服器。
- **backend_server.py** (虛擬機端)：接收樹莓派傳送過來的影像資料，並利用 Flask 提供 HTTP 影像串流服務。

## 所用技術

- **Python 3**  
  作為主要程式語言，簡化網路與影像相關程式設計。
  
- **OpenCV**  
  用於影像捕捉與處理（如尺寸調整與 JPEG 編碼）。

- **Socket 程式設計**  
  利用 Python 的 `socket` 模組建立 TCP 連線，實現影像的即時傳輸。

- **Flask**  
  輕量級的 Python Web 框架，用於提供網頁影像串流服務與簡易前端介面。

- **Threading**  
  多線程處理，讓 Socket 影像接收與 Flask 網頁服務能夠同步運行，提高系統效率與穩定性。

- **Tailscale**  
  利用 Tailscale VPN 解決跨網段連線問題，使遠端樹莓派與虛擬機之間能夠透過私有網路安全通訊。

## 優化重點

- **模組化設計：**  
  將影像尺寸調整及資料接收封裝成獨立函數 (`resize_frame` 與 `recvall`)，提升程式碼可讀性及維護性。

- **錯誤處理與重連機制：**  
  增加例外處理機制與重連邏輯，確保在連線失敗或攝影機錯誤時能自動回收資源並重試。

- **線程安全處理：**  
  使用 threading Lock 保護全域最新影像資料，確保多線程環境下資料不會競爭衝突。

- **簡化資料接收流程：**  
  利用 `recvall()` 函數確保接收固定長度資料，減少原有多重循環邏輯，穩定性更高。

## 使用方法

1. **環境建置：**  
   - 確認已安裝 Python 3 與 pip。  
   - 安裝所需套件：  
     ```
     pip install opencv-python flask
     ```

2. **設定 Tailscale IP：**  
   - 在 `sender.py` 與 `backend_server.py` 中，確認 `SERVER_IP` (或 `vm_tailscale_ip`) 已正確設定為虛擬機的 Tailscale IP。

3. **啟動程式：**  
   - 在樹莓派上執行 `sender.py`：  
     ```
     python3 sender.py
     ```
   - 在虛擬機上執行 `backend_server.py`，啟動 Flask 影像串流伺服器：  
     ```
     python3 backend_server.py
     ```
   - 透過瀏覽器訪問 `http://[虛擬機Tailscale IP]:5000` 以觀看即時影像。

## 結語

本專案透過模組化設計、完善的錯誤處理以及多線程配合，提供了一個穩定、高效、易於維護的影像傳輸與串流平臺。未來可進一步結合跌倒偵測演算法，將智慧型影像監控應用於安全監控與健康管理領域。
